{"version":3,"file":"usePopover.js","sourceRoot":"","sources":["../src/usePopover.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback } from 'react';\nimport {\n  BoundaryViolations,\n  PopoverState,\n  PositionPopover,\n  UsePopoverProps,\n  UsePopoverResult,\n} from '.';\nimport { EMPTY_RECT, createRect, getNewPopoverRect, getNudgedPopoverRect } from './util';\nimport { useElementRef } from './useElementRef';\n\nconst POPOVER_STYLE: Partial<CSSStyleDeclaration> = {\n  position: 'fixed',\n  overflow: 'visible',\n  top: '0px',\n  left: '0px',\n};\n\nconst SCOUT_STYLE: Partial<CSSStyleDeclaration> = {\n  position: 'fixed',\n  top: '0px',\n  left: '0px',\n  width: '0px',\n  height: '0px',\n  visibility: 'hidden',\n};\n\nexport const usePopover = ({\n  isOpen,\n  childRef,\n  positions,\n  containerClassName,\n  parentElement,\n  transform,\n  transformMode,\n  align,\n  padding,\n  reposition,\n  boundaryInset,\n  boundaryElement,\n  onPositionPopover,\n}: UsePopoverProps): UsePopoverResult => {\n  const scoutRef = useElementRef({ id: 'react-tiny-popover-scout', containerStyle: SCOUT_STYLE });\n  const popoverRef = useElementRef({\n    id: 'react-tiny-popover-container',\n    containerClassName,\n    containerStyle: POPOVER_STYLE,\n  });\n\n  const positionPopover = useCallback<PositionPopover>(\n    ({\n      positionIndex = 0,\n      parentRect = parentElement.getBoundingClientRect(),\n      childRect = childRef?.current?.getBoundingClientRect(),\n      scoutRect = scoutRef?.current?.getBoundingClientRect(),\n      popoverRect = popoverRef.current.getBoundingClientRect(),\n      boundaryRect = boundaryElement === parentElement\n        ? parentRect\n        : boundaryElement.getBoundingClientRect(),\n    } = {}) => {\n      if (!childRect || !parentRect || !isOpen) {\n        return;\n      }\n\n      if (transform && transformMode === 'absolute') {\n        const { top: inputTop, left: inputLeft } =\n          typeof transform === 'function'\n            ? transform({\n                childRect,\n                popoverRect,\n                parentRect,\n                boundaryRect,\n                padding,\n                align,\n                nudgedTop: 0,\n                nudgedLeft: 0,\n                boundaryInset,\n                violations: EMPTY_RECT,\n                hasViolations: false,\n              })\n            : transform;\n\n        const finalLeft = Math.round(parentRect.left + inputLeft - scoutRect.left);\n        const finalTop = Math.round(parentRect.top + inputTop - scoutRect.top);\n\n        popoverRef.current.style.transform = `translate(${finalLeft}px, ${finalTop}px)`;\n\n        onPositionPopover({\n          childRect,\n          popoverRect: createRect({\n            left: finalLeft,\n            top: finalTop,\n            width: popoverRect.width,\n            height: popoverRect.height,\n          }),\n          parentRect,\n          boundaryRect,\n          padding,\n          align,\n          transform: { top: inputTop, left: inputLeft },\n          nudgedTop: 0,\n          nudgedLeft: 0,\n          boundaryInset,\n          violations: EMPTY_RECT,\n          hasViolations: false,\n        });\n\n        return;\n      }\n\n      const isExhausted = positionIndex === positions.length;\n      const position = isExhausted ? positions[0] : positions[positionIndex];\n\n      const { rect, boundaryViolation } = getNewPopoverRect(\n        {\n          childRect,\n          popoverRect,\n          boundaryRect,\n          position,\n          align,\n          padding,\n          reposition,\n        },\n        boundaryInset,\n      );\n\n      if (boundaryViolation && reposition && !isExhausted) {\n        positionPopover({\n          positionIndex: positionIndex + 1,\n          childRect,\n          popoverRect,\n          parentRect,\n          boundaryRect,\n        });\n        return;\n      }\n\n      const { top, left, width, height } = rect;\n      const shouldNudge = reposition && !isExhausted;\n      const { left: nudgedLeft, top: nudgedTop } = getNudgedPopoverRect(\n        rect,\n        boundaryRect,\n        boundaryInset,\n      );\n\n      let finalTop = top;\n      let finalLeft = left;\n\n      if (shouldNudge) {\n        finalTop = nudgedTop;\n        finalLeft = nudgedLeft;\n      }\n\n      finalTop = Math.round(finalTop - scoutRect.top);\n      finalLeft = Math.round(finalLeft - scoutRect.left);\n\n      popoverRef.current.style.transform = `translate(${finalLeft}px, ${finalTop}px)`;\n\n      const potentialViolations: BoundaryViolations = {\n        top: boundaryRect.top + boundaryInset - finalTop,\n        left: boundaryRect.left + boundaryInset - finalLeft,\n        right: finalLeft + width - boundaryRect.right + boundaryInset,\n        bottom: finalTop + height - boundaryRect.bottom + boundaryInset,\n      };\n\n      const popoverState: PopoverState = {\n        childRect,\n        popoverRect: createRect({ left: finalLeft, top: finalTop, width, height }),\n        parentRect,\n        boundaryRect,\n        position,\n        align,\n        padding,\n        nudgedTop: nudgedTop - top,\n        nudgedLeft: nudgedLeft - left,\n        boundaryInset,\n        violations: {\n          top: potentialViolations.top <= 0 ? 0 : potentialViolations.top,\n          left: potentialViolations.left <= 0 ? 0 : potentialViolations.left,\n          right: potentialViolations.right <= 0 ? 0 : potentialViolations.right,\n          bottom: potentialViolations.bottom <= 0 ? 0 : potentialViolations.bottom,\n        },\n        hasViolations:\n          potentialViolations.top > 0 ||\n          potentialViolations.left > 0 ||\n          potentialViolations.right > 0 ||\n          potentialViolations.bottom > 0,\n      };\n\n      if (transform) {\n        onPositionPopover(popoverState);\n        const { top: transformTop, left: transformLeft } =\n          typeof transform === 'function' ? transform(popoverState) : transform;\n\n        popoverRef.current.style.transform = `translate(${Math.round(\n          finalLeft + (transformLeft ?? 0),\n        )}px, ${Math.round(finalTop + (transformTop ?? 0))}px)`;\n\n        popoverState.nudgedLeft += transformLeft ?? 0;\n        popoverState.nudgedTop += transformTop ?? 0;\n        popoverState.transform = { top: transformTop, left: transformLeft };\n      }\n\n      onPositionPopover(popoverState);\n    },\n    [\n      parentElement,\n      childRef,\n      scoutRef,\n      popoverRef,\n      boundaryElement,\n      isOpen,\n      transform,\n      transformMode,\n      positions,\n      align,\n      padding,\n      reposition,\n      boundaryInset,\n      onPositionPopover,\n    ],\n  );\n\n  return { positionPopover, popoverRef, scoutRef } as const;\n};\n"]}